#pragma once

#include "modalpha.h"
#include "scores.h"
#include "const_helpers.h"

struct bg_def
{
	char a;
	char b;
	unsigned score_;
};

constexpr inline int from_printable_flex(char const ch)
{
	if (ch > 'Z')
		return ch - 'a';
	return ch - 'A';
}

constexpr bigram_table make_bigram_table(bg_def const* b, bg_def const* e)
{
	std::array<unsigned, stride_ * alpha_max> wking;
	epicyclism::cfor_each(b, e, [&wking](auto const& bg)
	{
		wking[from_printable_flex(bg.a_) * stride_ + from_printable_flex(bg.b_)] = bg.score_;
	});
}

// this table is derived from the 'gen' data supplied with 
// 'enigma-suite-0.76.2' by Stefan Krah <stefan@bytereef.org>
//
constexpr struct bg_def gen_bg[]
{
{e, r,	71964},
{e, n, 	71048},
{c, h, 	70981},
{e, i, 	70210},
{i, n, 	65013},
{r, e, 	64027},
{u, n, 	63660},
{t, e, 	62679},
{n, s, 	62470},
{i, e, 	62470},
{g, e, 	62364},
{s, e, 	62149},
{u, e, 	62040},
{b, e, 	61299},
{n, u, 	61240},
{h, t, 	60752},
{s, t, 	60499},
{z, w, 	60304},
{w, o, 	60173},
{u, l, 	59972},
{a, c, 	59698},
{s, s, 	59345},
{f, u, 	58978},
{n, d, 	58828},
{a, n, 	58442},
{n, e, 	58363},
{d, r, 	57958},
{o, n, 	57875},
{n, f, 	57536},
{r, s, 	57449},
{l, e, 	57449},
{n, g, 	56913},
{s, i, 	56821},
{e, b, 	56634},
{e, s, 	56540},
{e, c, 	56540},
{t, a, 	56444},
{e, u, 	56250},
{i, t, 	56052},
{d, e, 	56052},
{i, c, 	55747},
{s, c, 	55643},
{r, a, 	55643},
{e, l, 	55326},
{h, e, 	54998},
{v, o, 	54659},
{n, a, 	54659},
{n, n, 	54543},
{o, r,  54308},
{f, e, 	54188},
{a, r, 	53820},
{e, h, 	53694},
{a, u, 	53694},
{h, s, 	53041},
{v, i, 	52341},
{u, f, 	51897},
{t, o, 	51897},
{r, t, 	51897},
{v, e, 	51744},
{l, u, 	51744},
{l, a, 	51589},
{e, t, 	51589},
{m, a, 	51431},
{h, r, 	51271},
{n, j, 	50775},
{e, d, 	50775},
{a, e, 	50775},
{n, t, 	50604},
{k, e, 	50604},
{n, x, 	50431},
{i, s, 	50431},
{n, v, 	50254},
{t, x, 	50073},
{q, u, 	49890},
{r, u, 	49703},
{a, l, 	49703},
{e, f, 	49512},
{o, t, 	49318},
{y, s, 	49120},
{o, s, 	49120},
{m, e, 	49120},
{l, l, 	49120},
{f, a, 	49120},
{w, e, 	48712},
{u, s, 	48712},
{g, r, 	48712},
{f, f, 	48712},
{w, a, 	48501},
{t, y, 	48286},
{t, z, 	48067},
{s, n, 	48067},
{o, e, 	48067},
{n, k, 	48067},
{h, l, 	48067},
{h, a, 	47842},
{a, d, 	47842},
{t, t, 	47612},
{t, s, 	47612},
{l, n, 	47612},
{u, r, 	46889},
{s, a, 	46636},
{m, i, 	46636},
{i, g, 	46636},
{z, e, 	46376},
{v, v, 	46376},
{o, o, 	46376},
{a, m, 	46376},
{a, b, 	46376},
{y, e, 	46109},
{t, i, 	46109},
{r, i, 	46109},
{r, g, 	45835},
{n, o, 	45835},
{e, g, 	45835},
{d, a, 	45835},
{c, k, 	45835},
{b, o, 	45835},
{r, n, 	45553},
{n, y, 	45553},
{u, a, 	45264},
{r, y, 	45264},
{b, i, 	45264},
{a, s, 	44965},
{t, n, 	44657},
{s, y, 	44657},
{s, m, 	44657},
{p, e, 	44657},
{u, g, 	44340},
{e, m, 	44340},
{d, o, 	44340},
{z, u, 	44012},
{y, y, 	44012},
{x, s, 	44012},
{t, u, 	44012},
{s, u, 	44012},
{r, k, 	44012},
{r, f, 	44012},
{n, i, 	44012},
{l, s, 	44012},
{k, u, 	44012},
{y, n, 	43673},
{s, x, 	43673},
{l, t, 	43673},
{l, i, 	43673},
{d, u, 	43673},
{a, t, 	43673},
{r, z, 	43322},
{r, q, 	43322},
{n, b, 	42958},
{m, b, 	42958},
{k, t, 	42958},
{j, s, 	42958},
{f, t, 	42958},
{w, w, 	42581},
{u, c, 	42581},
{r, j, 	42581},
{r, d, 	42581},
{o, f, 	42581},
{e, e, 	42581},
{a, g, 	42581},
{x, e, 	42189},
{w, i, 	42189},
{t, r, 	42189},
{s, o, 	42189},
{r, x, 	42189},
{r, m, 	42189},
{o, m, 	42189},
{o, d, 	42189},
{n, z, 	42189},
{y, d, 	41781},
{s, z, 	41781},
{l, d, 	41781},
{b, r, 	41781},
{x, a, 	41355},
{t, v, 	41355},
{s, g, 	40910},
{l, b, 	40910},
{e, w, 	40910},
{y, z, 	40445},
{u, h, 	40445},
{r, o, 	40445},
{m, m, 	40445},
{h, u, 	40445},
{h, o, 	40445},
{x, z, 	39957},
{x, n, 	39957},
{u, u, 	39957},
{s, d, 	39957},
{r, v, 	39957},
{i, l, 	39957},
{b, m, 	39957},
{x, v, 	39444},
{v, j, 	39444},
{t, f, 	39444},
{s, v, 	39444},
{n, w, 	39444},
{m, y, 	39444},
{j, o, 	39444},
{i, m, 	39444},
{g, s, 	39444},
{e, a, 	39444},
{d, i, 	39444},
{u, t, 	38904},
{u, m, 	38904},
{t, m, 	38904},
{r, w, 	38904},
{r, c, 	38904},
{i, y, 	38904},
{i, d, 	38904},
{c, b, 	38904},
{a, h, 	38904},
{r, l, 	38332},
{o, b, 	38332},
{i, f, 	38332},
{h, n, 	38332},
{t, g, 	37726},
{o, y, 	37726},
{g, u, 	37726},
{g, a, 	37726},
{e, y, 	37726},
{d, y, 	37726},
{b, a, 	37726},
{y, f, 	37081},
{x, b, 	37081},
{t, d, 	37081},
{s, f, 	37081},
{p, f, 	37081},
{o, v, 	37081},
{o, l, 	37081},
{k, o, 	37081},
{k, l, 	37081},
{f, n, 	37081},
{f, l, 	37081},
{f, g, 	37081},
{t, b, 	36391},
{p, p, 	36391},
{o, x, 	36391},
{o, h, 	36391},
{m, z, 	36391},
{m, p, 	36391},
{l, o, 	36391},
{l, g, 	36391},
{j, f, 	36391},
{g, x, 	36391},
{f, o, 	36391},
{z, t, 	35649},
{x, m, 	35649},
{x, f, 	35649},
{t, w, 	35649},
{t, l, 	35649},
{t, k, 	35649},
{s, b, 	35649},
{r, h, 	35649},
{r, b, 	35649},
{p, a, 	35649},
{o, p, 	35649},
{n, l, 	35649},
{k, m, 	35649},
{h, x, 	35649},
{h, w, 	35649},
{e, v, 	35649},
{a, a, 	35649},
{y, g, 	34849},
{o, c, 	34849},
{m, u, 	34849},
{m, s, 	34849},
{g, l, 	34849},
{f, s, 	34849},
{e, j, 	34849},
{b, s, 	34849},
{b, g, 	34849},
{a, f, 	34849},
{y, k, 	33979},
{x, d, 	33979},
{o, a, 	33979},
{k, r, 	33979},
{e, k, 	33979},
{y, w, 	33026},
{y, b, 	33026},
{u, p, 	33026},
{u, b, 	33026},
{t, j, 	33026},
{o, z, 	33026},
{n, r, 	33026},
{m, t, 	33026},
{l, v, 	33026},
{k, s, 	33026},
{j, e, 	33026},
{h, i, 	33026},
{g, y, 	33026},
{g, t, 	33026},
{g, n, 	33026},
{e, x, 	33026},
{d, s, 	33026},
{x, t, 	31972},
{s, p, 	31972},
{p, l, 	31972},
{i, r, 	31972},
{g, v, 	31972},
{f, z, 	31972},
{f, x, 	31972},
{f, r, 	31972},
{e, z, 	31972},
{e, p, 	31972},
{e, o, 	31972},
{x, r, 	30794},
{x, q, 	30794},
{x, l, 	30794},
{u, z, 	30794},
{s, w, 	30794},
{m, x, 	30794},
{m, o, 	30794},
{l, z, 	30794},
{l, y, 	30794},
{l, f, 	30794},
{j, n, 	30794},
{j, k, 	30794},
{i, x, 	30794},
{h, f, 	30794},
{h, d, 	30794},
{g, z, 	30794},
{g, m, 	30794},
{f, v, 	30794},
{f, b, 	30794},
{b, y, 	30794},
{b, u, 	30794},
{b, l, 	30794},
{y, m, 	29459},
{y, l, 	29459},
{y, a, 	29459},
{x, x, 	29459},
{x, i, 	29459},
{r, r, 	29459},
{r, p, 	29459},
{n, m, 	29459},
{j, b, 	29459},
{j, a, 	29459},
{h, z, 	29459},
{h, m, 	29459},
{f, y, 	29459},
{f, m, 	29459},
{d, x, 	29459},
{d, v, 	29459},
{d, l, 	29459},
{d, g, 	29459},
{d, f, 	29459},
{z, o, 	27918},
{z, a, 	27918},
{y, v, 	27918},
{y, p, 	27918},
{x, w, 	27918},
{x, k, 	27918},
{s, j, 	27918},
{m, v, 	27918},
{m, g, 	27918},
{l, m, 	27918},
{l, k, 	27918},
{k, a, 	27918},
{j, v, 	27918},
{j, m, 	27918},
{i, z, 	27918},
{i, o, 	27918},
{i, b, 	27918},
{i, a, 	27918},
{h, v, 	27918},
{h, b, 	27918},
{d, n, 	27918},
{c, a, 	27918},
{a, v, 	27918},
{y, j, 	26094},
{y, c, 	26094},
{t, q, 	26094},
{t, h, 	26094},
{s, k, 	26094},
{s, h, 	26094},
{p, o, 	26094},
{o, g, 	26094},
{n, h, 	26094},
{n, c, 	26094},
{l, c, 	26094},
{j, l, 	26094},
{h, y, 	26094},
{g, k, 	26094},
{g, d, 	26094},
{f, p, 	26094},
{f, h, 	26094},
{d, w, 	26094},
{d, d, 	26094},
{b, t, 	26094},
{y, r, 	23863},
{y, o, 	23863},
{x, u, 	23863},
{x, g, 	23863},
{s, q, 	23863},
{p, r, 	23863},
{o, k, 	23863},
{m, n, 	23863},
{j, y, 	23863},
{j, x, 	23863},
{j, w, 	23863},
{j, u, 	23863},
{j, h, 	23863},
{j, d, 	23863},
{g, g, 	23863},
{g, b, 	23863},
{f, d, 	23863},
{d, z, 	23863},
{d, t, 	23863},
{d, j, 	23863},
{d, b, 	23863},
{b, f, 	23863},
{b, d, 	23863},
{a, p, 	23863},
{y, u, 	20986},
{y, t, 	20986},
{y, i, 	20986},
{x, j, 	20986},
{x, h, 	20986},
{w, d, 	20986},
{t, p, 	20986},
{s, r, 	20986},
{p, u, 	20986},
{p, t, 	20986},
{o, w, 	20986},
{o, u, 	20986},
{n, q, 	20986},
{m, k, 	20986},
{m, f, 	20986},
{l, w, 	20986},
{j, z, 	20986},
{j, r, 	20986},
{j, j, 	20986},
{i, v, 	20986},
{i, u, 	20986},
{h, p, 	20986},
{h, j, 	20986},
{h, g, 	20986},
{g, w, 	20986},
{g, i, 	20986},
{g, f, 	20986},
{c, o, 	20986},
{c, e, 	20986},
{b, v, 	20986},
{a, z, 	20986},
{z, v, 	16931},
{z, r, 	16931},
{z, i, 	16931},
{y, h, 	16931},
{x, p, 	16931},
{w, z, 	16931},
{w, s, 	16931},
{w, f, 	16931},
{u, y, 	16931},
{u, v, 	16931},
{s, l, 	16931},
{p, y, 	16931},
{p, h, 	16931},
{n, p, 	16931},
{m, h, 	16931},
{m, d, 	16931},
{l, x, 	16931},
{k, v, 	16931},
{k, i, 	16931},
{k, b, 	16931},
{i, k, 	16931},
{i, i, 	16931},
{g, q, 	16931},
{f, k, 	16931},
{f, j, 	16931},
{f, i, 	16931},
{f, c, 	16931},
{d, m, 	16931},
{b, z, 	16931},
{b, b, 	16931},
{a, y, 	16931},
{a, k, 	16931},
{a, j, 	16931},
{z, s, 	10000},
{z, n, 	10000},
{z, l, 	10000},
{z, k, 	10000},
{z, d, 	10000},
{y, q, 	10000},
{x, y, 	10000},
{x, o, 	10000},
{w, v, 	10000},
{w, t, 	10000},
{w, r, 	10000},
{w, n, 	10000},
{v, m, 	10000},
{v, a, 	10000},
{u, x, 	10000},
{u, w, 	10000},
{u, o, 	10000},
{u, k, 	10000},
{p, x, 	10000},
{p, i, 	10000},
{o, j, 	10000},
{m, w, 	10000},
{m, l, 	10000},
{l, p, 	10000},
{l, h, 	10000},
{k, y, 	10000},
{k, p, 	10000},
{j, t, 	10000},
{j, q, 	10000},
{j, p, 	10000},
{j, i, 	10000},
{j, g, 	10000},
{i, q, 	10000},
{i, h, 	10000},
{h, k, 	10000},
{g, h, 	10000},
{f, w, 	10000},
{d, q, 	10000},
{d, h, 	10000},
{c, z, 	10000},
{c, x, 	10000},
{c, u, 	10000},
{c, s, 	10000},
{b, w, 	10000},
{b, k, 	10000},
{a, x, 	10000},
{a, i, 	10000},
{z, z, 	0 }};
